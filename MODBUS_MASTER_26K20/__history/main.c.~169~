#include <main.h>

#define LOADER_END   0x5FF
#include <bootloader.h>

#define RS485_USE_EXT_INT TRUE

#define RS485_RX_PIN PIN_B0
#define RS485_TX_PIN PIN_B3

#define RS485_ENABLE_PIN PIN_B4
#define RS485_RX_ENABLE PIN_B5

#define MODBUS_TYPE MODBUS_TYPE_MASTER
#define MODBUS_SERIAL_TYPE MODBUS_RTU     //use MODBUS_ASCII for ASCII mode
#define MODBUS_SERIAL_RX_BUFFER_SIZE 64
#define MODBUS_SERIAL_BAUD 9600

#define MODBUS_SERIAL_INT_SOURCE MODBUS_INT_EXT

#define MODBUS_SERIAL_TX_PIN PIN_B3   // Data transmit pin
#define MODBUS_SERIAL_RX_PIN PIN_B0   // Data receive pin

#define MODBUS_SERIAL_ENABLE_PIN   PIN_B4   // Controls DE pin for RS485
#define MODBUS_SERIAL_RX_ENABLE    PIN_B5   // Controls RE pin for RS485

#define MODBUS_SLAVE_ADDRESS 1

#include <stdlib.h>
//#include <variaveis.c>
#include <modbus_local.c>
#include <umodbus.c>
//#include <userial.c>

/*#INT_RDA
void serial_isr(){ evt_serial(); }*/

void main()
{
   //MotivoInicializacao();
   
   setup_adc_ports(NO_ANALOGS);
   //init_pic();   
   modbus_init();
   
   while(TRUE){
      read_all_coils();
   }
}

